// ============================================================================
// Automatic Dark Mode Mixins
// ============================================================================
// These mixins generate utilities that respond to both:
// 1. System preference (prefers-color-scheme: dark)
// 2. Manual .dark class toggle
// ============================================================================

@use 'sass:map';

// Generate a dark mode utility that responds to system preference AND .dark class
// Usage: @include dark-mode-utility('text-gray-900', 'color', #fff);
@mixin dark-mode-utility($class-name, $property, $dark-value, $light-value: null) {
  // Light mode (default)
  @if $light-value != null {
    .#{$class-name} {
      #{$property}: $light-value;
    }
  }

  // Dark mode via media query (system preference)
  @media (prefers-color-scheme: dark) {
    .#{$class-name} {
      #{$property}: $dark-value;
    }
  }

  // Dark mode via data-theme="dark" attribute (manual toggle)
  [data-theme="dark"] .#{$class-name} {
    #{$property}: $dark-value;
  }
}

// Generate multiple dark mode utilities from a map
// Usage:
//   $dark-colors: (white: #111827, black: #fff);
//   @include dark-mode-utilities-from-map('bg', 'background-color', $dark-colors);
@mixin dark-mode-utilities-from-map($class-prefix, $property, $value-map) {
  @each $name, $dark-value in $value-map {
    $class-name: '#{$class-prefix}-#{$name}';

    // Dark mode via media query (system preference)
    @media (prefers-color-scheme: dark) {
      .#{$class-name} {
        #{$property}: $dark-value;
      }
    }

    // Dark mode via data-theme="dark" attribute (manual toggle)
    [data-theme="dark"] .#{$class-name} {
      #{$property}: $dark-value;
    }
  }
}

// Generate dark mode utilities with both light and dark values
// Usage:
//   $color-pairs: (gray-50: (light: #f9fafb, dark: #1f2937));
//   @include dark-mode-paired-utilities('bg', 'background-color', $color-pairs);
@mixin dark-mode-paired-utilities($class-prefix, $property, $value-pairs) {
  @each $name, $pair in $value-pairs {
    $class-name: '#{$class-prefix}-#{$name}';
    $light-value: map.get($pair, 'light');
    $dark-value: map.get($pair, 'dark');

    // Light mode (default)
    .#{$class-name} {
      #{$property}: $light-value;
    }

    // Dark mode via media query (system preference)
    @media (prefers-color-scheme: dark) {
      .#{$class-name} {
        #{$property}: $dark-value;
      }
    }

    // Dark mode via data-theme="dark" attribute (manual toggle)
    [data-theme="dark"] .#{$class-name} {
      #{$property}: $dark-value;
    }
  }
}

// Generate dark mode utilities for opacity variants
// Usage: @include dark-mode-opacity-utilities('bg-gray-50', 'background-color', $color, $opacity-values);
@mixin dark-mode-opacity-utilities($class-prefix, $property, $base-dark-color, $opacity-values) {
  @each $opacity-name, $opacity-value in $opacity-values {
    @if $opacity-value < 1 {
      $class-name: '#{$class-prefix}\\/#{$opacity-name}';

      // Dark mode via media query (system preference)
      @media (prefers-color-scheme: dark) {
        .#{$class-name} {
          #{$property}: rgba(
            red($base-dark-color),
            green($base-dark-color),
            blue($base-dark-color),
            $opacity-value
          );
        }
      }

      // Dark mode via data-theme="dark" attribute (manual toggle)
      [data-theme="dark"] .#{$class-name} {
        #{$property}: rgba(
          red($base-dark-color),
          green($base-dark-color),
          blue($base-dark-color),
          $opacity-value
        );
      }
    }
  }
}

// Generate hover state dark mode utilities
// Usage: @include dark-mode-hover-utilities('bg-gray-50', 'background-color', $dark-color);
@mixin dark-mode-hover-utilities($class-prefix, $property, $dark-value, $opacity-values: ()) {
  // Dark mode via media query (system preference)
  @media (prefers-color-scheme: dark) {
    .#{$class-prefix}:hover {
      #{$property}: $dark-value;
    }
  }

  // Dark mode via data-theme="dark" attribute (manual toggle)
  [data-theme="dark"] .#{$class-prefix}:hover {
    #{$property}: $dark-value;
  }

  // Opacity variants for hover
  @each $opacity-name, $opacity-value in $opacity-values {
    @if $opacity-value < 1 {
      $escaped-name: '#{$class-prefix}\\/#{$opacity-name}';

      // Media query hover with opacity
      @media (prefers-color-scheme: dark) {
        .#{$escaped-name}:hover {
          #{$property}: rgba(
            red($dark-value),
            green($dark-value),
            blue($dark-value),
            $opacity-value
          );
        }
      }

      // data-theme="dark" hover with opacity
      [data-theme="dark"] .#{$escaped-name}:hover {
        #{$property}: rgba(
          red($dark-value),
          green($dark-value),
          blue($dark-value),
          $opacity-value
        );
      }
    }
  }
}

// Generate color scale dark mode utilities (lightens text, darkens backgrounds)
// Usage: @include dark-mode-color-scale-utilities('text', 'color', $color-scale-map);
@mixin dark-mode-color-scale-utilities($class-prefix, $property, $color-scale) {
  @each $key, $value in $color-scale {
    $class-name: '#{$class-prefix}-#{$key}';

    // Determine dark mode value based on property
    @if $property == 'color' {
      // Text colors get lightened in dark mode
      $dark-value: lighten($value, 10%);

      @media (prefers-color-scheme: dark) {
        .#{$class-name} {
          #{$property}: $dark-value;
        }
      }

      [data-theme="dark"] .#{$class-name} {
        #{$property}: $dark-value;
      }
    } @else if $property == 'background-color' {
      // Background colors get darkened in dark mode
      $dark-value: darken($value, 20%);

      @media (prefers-color-scheme: dark) {
        .#{$class-name} {
          #{$property}: $dark-value;
        }
      }

      [data-theme="dark"] .#{$class-name} {
        #{$property}: $dark-value;
      }
    }
  }
}
